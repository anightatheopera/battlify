{% extends "base.html" %}

{% block title %}Home - Lorian Awards{% endblock %}

{% block content %}
<div class="container">
    <div id="create-section" style="display:none; margin-bottom: 40px; text-align: center;">
        <a href="/create" style="display:inline-block; background: var(--accent-color); color:black; padding: 15px 30px; border-radius: 5px; font-weight:bold; font-family:'Cinzel', serif;">
            + Create New Bracket
        </a>
    </div>

    <div class="tabs">
        <button class="tab-btn active" onclick="switchTab('active')">Active Tournaments</button>
        <button class="tab-btn" onclick="switchTab('past')">Past Tournaments</button>
    </div>

    <div id="loading">Loading tournaments...</div>

    <div id="active-container">
        <ul id="active-list" class="tournament-list"></ul>
        <p id="no-active-msg" style="text-align:center; color:#666; display:none;">No active tournaments right now.</p>
    </div>

    <div id="past-container" class="hidden">
        <ul id="past-list" class="tournament-list"></ul>
        <p id="no-past-msg" style="text-align:center; color:#666; display:none;">No past tournaments found.</p>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    if (isLoggedIn()) {
        const createSec = document.getElementById('create-section');
        if(createSec) createSec.style.display = 'block';
    }

    function switchTab(tabName) {
        const activeBtn = document.querySelector("button[onclick=\"switchTab('active')\"]");
        const pastBtn = document.querySelector("button[onclick=\"switchTab('past')\"]");
        const activeContainer = document.getElementById('active-container');
        const pastContainer = document.getElementById('past-container');

        if (tabName === 'active') {
            activeBtn.classList.add('active'); pastBtn.classList.remove('active');
            activeContainer.classList.remove('hidden'); pastContainer.classList.add('hidden');
        } else {
            activeBtn.classList.remove('active'); pastBtn.classList.add('active');
            activeContainer.classList.add('hidden'); pastContainer.classList.remove('hidden');
        }
    }

    fetch('/api/vote/tournaments')
        .then(res => res.json())
        .then(data => {
            document.getElementById('loading').style.display = 'none';
            const activeList = document.getElementById('active-list');
            const pastList = document.getElementById('past-list');
            let activeCount = 0; let pastCount = 0;

            data.forEach(t => {
                const li = document.createElement('li');
                const manageLink = isLoggedIn() ? ` <a href="/manage/${t._id}" style="font-size:0.8em; float:right; color:#888;">[Manage]</a>` : '';
                li.innerHTML = `<a href="/bracket/${t._id}" style="display:inline;">${t.name}</a>${manageLink}`;
                if (t.status === 'active') { activeList.appendChild(li); activeCount++; } 
                else if (t.status === 'completed') { pastList.appendChild(li); pastCount++; }
            });

            if (activeCount === 0) document.getElementById('no-active-msg').style.display = 'block';
            if (pastCount === 0) document.getElementById('no-past-msg').style.display = 'block';
        })
        .catch(err => { document.getElementById('loading').innerText = "Error loading data."; });
</script>
{% endblock %}